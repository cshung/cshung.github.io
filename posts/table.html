<html>
<head>
<title>Visualize Table</title>
</head>
<body>
    <div dir="ltr" style="text-align: left;" trbidi="on"><b style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;">Problem</b><br /><br style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;" /><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;">Please find the problem&nbsp;</span><a href="http://www.spoj.com/problems/LITE/" style="background-color: white; color: #888888; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px; text-decoration: none;">here</a><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;">.</span><br /><br style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;" /><b style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;">Solution:</b><br /><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;"><br /></span><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">After doing some optimization - the previous solution still cannot be accepted - need to try something else. Previously I was worried about memory consumption creating a full blown segment tree by virtualizing the segments. What if I just create it? Again, we consider this simple example of inserting the segment [1, 5] and [3, 7]</span></span><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;"><br /></span></span><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">Initially the tree is completely empty.</span></span><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;"><br /></span></span><br /><table border="1" cellpadding="0" cellspacing="0" class="MsoTableGrid" style="border-collapse: collapse; border: none; text-align: center;"> <tbody><tr>  <td colspan="4" style="border: solid windowtext 1.0pt; mso-border-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.7pt;" valign="top" width="288"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>&nbsp;0</o:p></div></td>  <td colspan="4" style="border-left: none; border: solid windowtext 1.0pt; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.8pt;" valign="top" width="288"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td> </tr><tr>  <td colspan="2" style="border-top: none; border: solid windowtext 1.0pt; mso-border-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.8pt;" valign="top" width="144"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>&nbsp;0</o:p></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td> </tr><tr>  <td style="border-top: none; border: solid windowtext 1.0pt; mso-border-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>&nbsp;0</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><o:p>0&nbsp;</o:p></div></td> </tr><!--[if !supportMisalignedColumns]--><tr height="0">  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td>  <td style="border: none; text-align: center;" width="72"></td> </tr><!--[endif]--></tbody></table><br /><div class="MsoNormal" style="text-align: center;"><br /></div><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;">Now we insert [1, 5]</span><br /><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;"><br /></span><br /><table border="0" cellpadding="0" cellspacing="0" class="MsoNormalTable" style="border-collapse: collapse; mso-padding-alt: 0in 0in 0in 0in; mso-yfti-tbllook: 1184;"> <tbody><tr>  <td colspan="4" style="background: yellow; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.7pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">&nbsp;4<o:p></o:p></span></div></td>  <td colspan="4" style="border-left: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.8pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td> </tr><tr>  <td colspan="2" style="border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.8pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">&nbsp;0<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr><tr>  <td style="border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">&nbsp;0<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr><tr>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td> </tr></tbody></table><br /><div class="MsoNormal"><br /></div><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">The highlighted cell is the key idea - I don't want to update all the leaves cells. If I do then that would be slow, and I would just brute force instead.</span></span><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;"><br /></span></span><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">Now we insert [3, 7], it involve a cell that we lazily not propagating the changes down, so now we are forced to do, but let's do it just one level now.</span></span><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;"><br /></span></span><br /><table border="0" cellpadding="0" cellspacing="0" class="MsoNormalTable" style="border-collapse: collapse; mso-padding-alt: 0in 0in 0in 0in; mso-yfti-tbllook: 1184;"> <tbody><tr>  <td colspan="4" style="border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.7pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">4<o:p></o:p></span></div></td>  <td colspan="4" style="border-left: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.8pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td> </tr><tr>  <td colspan="2" style="background: yellow; border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.8pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td>  <td colspan="2" style="background: yellow; border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr><tr>  <td style="border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">&nbsp;0<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr><tr>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td>  <td style="padding: 0in 0in 0in 0in; width: .75in;" width="72"></td> </tr></tbody></table><br /><div class="MsoNormal"><br /></div><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">Now we are ready to go. The interval [3, 7] is splitted into [3, 4] and [4, 7]. Let's handle [3, 4] first. On the left hand side, all we need to do is to flip that lazy segment back and nothing further need to be done.</span></span><br /><br /><table border="0" cellpadding="0" cellspacing="0" class="MsoNormalTable" style="border-collapse: collapse; mso-padding-alt: 0in 0in 0in 0in; mso-yfti-tbllook: 1184;"> <tbody><tr>  <td colspan="4" style="border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.7pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td>  <td colspan="4" style="border-left: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.8pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td> </tr><tr>  <td colspan="2" style="background: yellow; border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.8pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr><tr>  <td style="border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">&nbsp;0<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr></tbody></table><b style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;"><br /></b><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">For the right hand side, it is similarly done splitted into [4, 6] and [7, 7]. For [4, 6], it covers the whole interval so we can also be lazy there too.</span></span><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;"><br /></span></span><br /><table border="0" cellpadding="0" cellspacing="0" class="MsoNormalTable" style="border-collapse: collapse; mso-padding-alt: 0in 0in 0in 0in; mso-yfti-tbllook: 1184;"> <tbody><tr>  <td colspan="4" style="border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.7pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td>  <td colspan="4" style="border-left: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 215.8pt;" valign="top" width="288"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td> </tr><tr>  <td colspan="2" style="background: yellow; border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 107.8pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">2<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0<o:p></o:p></span></div></td>  <td colspan="2" style="background: yellow; border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td>  <td colspan="2" style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 107.9pt;" valign="top" width="144"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1&nbsp;<o:p></o:p></span></div></td> </tr><tr>  <td style="border-top: none; border: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">&nbsp;0<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.9pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">1<o:p></o:p></span></div></td>  <td style="border-bottom: solid windowtext 1.0pt; border-left: none; border-right: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt; width: 53.95pt;" valign="top" width="72"><div align="center" class="MsoNormal" style="margin-bottom: 0.0001pt; text-align: center;"><span style="font-family: &quot;times new roman&quot; , serif;">0&nbsp;<o:p></o:p></span></div></td> </tr></tbody></table><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">Last, consider a query from [2, 6], we follow the normal segment tree query except that we do the work when we hit a lazy node, and that's it. Turn out both lazy nodes will need to be done for this case.</span></span><br /><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;">Note that for updates or query, neighboring intervals are doubling in size, so worst case is just processing $ O (\log n) $ intervals. Working on the lazy node is constant work at a time so no need to worry about it for complexity sake.&nbsp;</span></span><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;">We get an $ O (m \log n) $ algorithm, this time $ n $ is the number of lights. This is fast enough and get accepted. Compare with the previous algorithm, the previous algorithm is independent of $ n $, so in theory one could feed it billions of lights without worrying about time, but for small number of lights this is superior.</span><br /><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;"><br /></span><span style="background-color: white; color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif; line-height: 18.4799995422363px;">Another great advantage of this approach is simplicity, it took me no more than two hours to get this done. The simplicity will also allow us to evolve this approach to do harder problems.</span><br /><span style="color: #666666; font-family: &quot;trebuchet ms&quot; , &quot;trebuchet&quot; , &quot;verdana&quot; , sans-serif;"><span style="background-color: white; line-height: 18.4799995422363px;"><br /></span></span><b style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;">Code</b><br /><b style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; line-height: 18.4799995422363px;"><br /></b><br /><pre><span class="pre" style="color: #000099;">#include "stdafx.h"<br />#pragma warning(disable : 4996)<br /></span><span class="comment" style="color: #999999; font-style: italic;"><br />// http://www.spoj.com/problems/LITE/<br /></span><span class="pre" style="color: #000099;"><br />#include "SPOJ_LITE_2.h"<br />#include &lt;stdio.h&gt;<br />#include &lt;iostream&gt;<br />#include &lt;algorithm&gt;<br /></span><span class="keyword" style="color: #990000;"><br />namespace</span> _SPOJ_LITE_2<span class="operator" style="color: #663300; font-weight: bold;"><br />{</span><span class="keyword" style="color: #990000;"><br />    using namespace</span> std<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="keyword" style="color: #990000;"><br /><br />    class</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;"><br />    {</span><span class="keyword" style="color: #990000;"><br />    public</span><span class="operator" style="color: #663300; font-weight: bold;">:</span><br />        SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> size<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="type" style="color: #ff6633;"><br />        void</span> flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="type" style="color: #ff6633;"><br />        int</span> query<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="type" style="color: #ff6633;"><br />        void</span> print<span class="operator" style="color: #663300; font-weight: bold;">()</span><span class="keyword" style="color: #990000;"> const</span><span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="keyword" style="color: #990000;"><br />    private</span><span class="operator" style="color: #663300; font-weight: bold;">:</span><span class="keyword" style="color: #990000;"><br />        class</span> SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;"><br />        {</span><span class="keyword" style="color: #990000;"><br />        public</span><span class="operator" style="color: #663300; font-weight: bold;">:</span><br />            SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="type" style="color: #ff6633;"><br />            void</span> flip_children<span class="operator" style="color: #663300; font-weight: bold;">();</span><span class="type" style="color: #ff6633;"><br />            void</span> flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="type" style="color: #ff6633;"><br />            int</span> query<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">) ;</span><span class="type" style="color: #ff6633;"><br />            void</span> print<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> indent<span class="operator" style="color: #663300; font-weight: bold;">)</span><span class="keyword" style="color: #990000;"> const</span><span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="type" style="color: #ff6633;"><br /><br />            int</span> from<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="type" style="color: #ff6633;"><br />            int</span> to<span class="operator" style="color: #663300; font-weight: bold;">;</span><br />            SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">*</span> left<span class="operator" style="color: #663300; font-weight: bold;">;</span><br />            SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">*</span> right<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="type" style="color: #ff6633;"><br />            int</span> on_count<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="type" style="color: #ff6633;"><br />            bool</span> children_flipped<span class="operator" style="color: #663300; font-weight: bold;">;<br />        };</span><br /><br />        SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">*</span> build_tree<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">)</span><span class="keyword" style="color: #990000;"> const</span><span class="operator" style="color: #663300; font-weight: bold;">;</span><br />        SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">*</span> root<span class="operator" style="color: #663300; font-weight: bold;">;<br />    };<br />}</span><span class="keyword" style="color: #990000;"><br /><br />using namespace</span> _SPOJ_LITE_2<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="keyword" style="color: #990000;"><br />using namespace</span> std<span class="operator" style="color: #663300; font-weight: bold;">;</span><br /><br />SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> size<span class="operator" style="color: #663300; font-weight: bold;">)<br />{</span><span class="keyword" style="color: #990000;"><br />    this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>root<span class="operator" style="color: #663300; font-weight: bold;"> =</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>build_tree<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="int" style="color: #999900;">0</span><span class="operator" style="color: #663300; font-weight: bold;">,</span> size<span class="operator" style="color: #663300; font-weight: bold;">);<br />}</span><span class="type" style="color: #ff6633;"><br /><br />void</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">)<br />{</span><span class="keyword" style="color: #990000;"><br />    this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>root<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span>from<span class="operator" style="color: #663300; font-weight: bold;">,</span> to<span class="operator" style="color: #663300; font-weight: bold;">);<br />}</span><span class="type" style="color: #ff6633;"><br /><br />int</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>query<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">) <br />{</span><span class="flow" style="color: red;"><br />    return</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>root<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>query<span class="operator" style="color: #663300; font-weight: bold;">(</span>from<span class="operator" style="color: #663300; font-weight: bold;">,</span> to<span class="operator" style="color: #663300; font-weight: bold;">);<br />}</span><span class="type" style="color: #ff6633;"><br /><br />void</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>print<span class="operator" style="color: #663300; font-weight: bold;">()</span><span class="keyword" style="color: #990000;"> const</span><span class="operator" style="color: #663300; font-weight: bold;"><br />{</span><span class="keyword" style="color: #990000;"><br />    this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>root<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>print<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="int" style="color: #999900;">0</span><span class="operator" style="color: #663300; font-weight: bold;">);<br />}</span><br /><br />SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">::</span>SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">) :</span> from<span class="operator" style="color: #663300; font-weight: bold;">(</span>from<span class="operator" style="color: #663300; font-weight: bold;">),</span> to<span class="operator" style="color: #663300; font-weight: bold;">(</span>to<span class="operator" style="color: #663300; font-weight: bold;">),</span> left<span class="operator" style="color: #663300; font-weight: bold;">(</span>NULL<span class="operator" style="color: #663300; font-weight: bold;">),</span> right<span class="operator" style="color: #663300; font-weight: bold;">(</span>NULL<span class="operator" style="color: #663300; font-weight: bold;">),</span> on_count<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="int" style="color: #999900;">0</span><span class="operator" style="color: #663300; font-weight: bold;">),</span> children_flipped<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="bool" style="font-weight: bold;">false</span><span class="operator" style="color: #663300; font-weight: bold;">)<br />{<br />}</span><span class="type" style="color: #ff6633;"><br /><br />void</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">::</span>flip_children<span class="operator" style="color: #663300; font-weight: bold;">()<br />{</span><span class="flow" style="color: red;"><br />    if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;"> ==</span> NULL<span class="operator" style="color: #663300; font-weight: bold;">)<br />    {</span><span class="flow" style="color: red;"><br />        if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;"> !=</span> NULL<span class="operator" style="color: #663300; font-weight: bold;">)<br />        {</span><span class="flow" style="color: red;"><br />            throw</span><span class="int" style="color: #999900;"> 0</span><span class="operator" style="color: #663300; font-weight: bold;">;<br />        }<br />    }</span><span class="flow" style="color: red;"><br />    else</span><span class="operator" style="color: #663300; font-weight: bold;"><br />    {</span><span class="keyword" style="color: #990000;"><br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="keyword" style="color: #990000;"><br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="keyword" style="color: #990000;"><br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;"> =</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;"> +</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="keyword" style="color: #990000;"><br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>children_flipped<span class="operator" style="color: #663300; font-weight: bold;"> =</span><span class="bool" style="font-weight: bold;"> false</span><span class="operator" style="color: #663300; font-weight: bold;">;<br />    }<br />}</span><span class="type" style="color: #ff6633;"><br /><br />void</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">::</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">)<br />{</span><span class="flow" style="color: red;"><br />    if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span>from<span class="operator" style="color: #663300; font-weight: bold;"> ==</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>from<span class="operator" style="color: #663300; font-weight: bold;"> &amp;&amp;</span> to<span class="operator" style="color: #663300; font-weight: bold;"> ==</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;">)<br />    {</span><span class="keyword" style="color: #990000;"><br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;"> = (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;"> -</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>from<span class="operator" style="color: #663300; font-weight: bold;">) -</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="keyword" style="color: #990000;"><br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>children_flipped<span class="operator" style="color: #663300; font-weight: bold;"> = !</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>children_flipped<span class="operator" style="color: #663300; font-weight: bold;">;<br />    }</span><span class="flow" style="color: red;"><br />    else</span><span class="operator" style="color: #663300; font-weight: bold;"><br />    {</span><span class="flow" style="color: red;"><br />        if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span>children_flipped<span class="operator" style="color: #663300; font-weight: bold;">)<br />        {</span><span class="keyword" style="color: #990000;"><br />            this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_children<span class="operator" style="color: #663300; font-weight: bold;">();<br />        }</span><span class="keyword" style="color: #990000;"><br />                    <br />        this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;"> =</span><span class="int" style="color: #999900;"> 0</span><span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="flow" style="color: red;"><br /><br />        if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;"> !=</span> NULL<span class="operator" style="color: #663300; font-weight: bold;">)<br />        {</span><span class="type" style="color: #ff6633;"><br />            int</span> left_from<span class="operator" style="color: #663300; font-weight: bold;"> =</span> from<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="type" style="color: #ff6633;"><br />            int</span> left_to<span class="operator" style="color: #663300; font-weight: bold;"> =</span> min<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;">,</span> to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="flow" style="color: red;"><br />            if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span>left_to<span class="operator" style="color: #663300; font-weight: bold;"> -</span> left_from<span class="operator" style="color: #663300; font-weight: bold;"> &gt;</span><span class="int" style="color: #999900;"> 0</span><span class="operator" style="color: #663300; font-weight: bold;">)<br />            {</span><span class="keyword" style="color: #990000;"><br />                this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span>left_from<span class="operator" style="color: #663300; font-weight: bold;">,</span> left_to<span class="operator" style="color: #663300; font-weight: bold;">);<br />            }</span><span class="keyword" style="color: #990000;"><br /><br />            this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;"> +=</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;">;<br />        }</span><span class="flow" style="color: red;"><br /><br />        if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;"> !=</span> NULL<span class="operator" style="color: #663300; font-weight: bold;">)<br />        {</span><span class="type" style="color: #ff6633;"><br />            int</span> right_from<span class="operator" style="color: #663300; font-weight: bold;"> =</span> max<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>from<span class="operator" style="color: #663300; font-weight: bold;">,</span> from<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="type" style="color: #ff6633;"><br />            int</span> right_to<span class="operator" style="color: #663300; font-weight: bold;"> =</span> to<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="flow" style="color: red;"><br />            if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span>right_to<span class="operator" style="color: #663300; font-weight: bold;"> -</span> right_from<span class="operator" style="color: #663300; font-weight: bold;"> &gt;</span><span class="int" style="color: #999900;"> 0</span><span class="operator" style="color: #663300; font-weight: bold;">)<br />            {</span><span class="keyword" style="color: #990000;"><br />                this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_lights<span class="operator" style="color: #663300; font-weight: bold;">(</span>right_from<span class="operator" style="color: #663300; font-weight: bold;">,</span> right_to<span class="operator" style="color: #663300; font-weight: bold;">);<br />            }</span><span class="keyword" style="color: #990000;"><br /><br />            this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;"> +=</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>right<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;">;<br />        }<br />    }<br />}</span><span class="type" style="color: #ff6633;"><br /><br />int</span> SegmentTree<span class="operator" style="color: #663300; font-weight: bold;">::</span>SegmentTreeNode<span class="operator" style="color: #663300; font-weight: bold;">::</span>query<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="type" style="color: #ff6633;">int</span> from<span class="operator" style="color: #663300; font-weight: bold;">,</span><span class="type" style="color: #ff6633;"> int</span> to<span class="operator" style="color: #663300; font-weight: bold;">) <br />{</span><span class="flow" style="color: red;"><br />    if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>from<span class="operator" style="color: #663300; font-weight: bold;"> ==</span> from<span class="operator" style="color: #663300; font-weight: bold;"> &amp;&amp;</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;"> ==</span> to<span class="operator" style="color: #663300; font-weight: bold;">)<br />    {</span><span class="flow" style="color: red;"><br />        return</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>on_count<span class="operator" style="color: #663300; font-weight: bold;">;<br />    }</span><span class="flow" style="color: red;"><br />    else</span><span class="operator" style="color: #663300; font-weight: bold;"><br />    {</span><span class="flow" style="color: red;"><br />        if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span>children_flipped<span class="operator" style="color: #663300; font-weight: bold;">)<br />        {</span><span class="keyword" style="color: #990000;"><br />            this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>flip_children<span class="operator" style="color: #663300; font-weight: bold;">();<br />        }</span><span class="type" style="color: #ff6633;"><br /><br />        int</span> result<span class="operator" style="color: #663300; font-weight: bold;"> =</span><span class="int" style="color: #999900;"> 0</span><span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="flow" style="color: red;"><br /><br />        if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;"> !=</span> NULL<span class="operator" style="color: #663300; font-weight: bold;">)<br />        {</span><span class="type" style="color: #ff6633;"><br />            int</span> left_from<span class="operator" style="color: #663300; font-weight: bold;"> =</span> from<span class="operator" style="color: #663300; font-weight: bold;">;</span><span class="type" style="color: #ff6633;"><br />            int</span> left_to<span class="operator" style="color: #663300; font-weight: bold;"> =</span> min<span class="operator" style="color: #663300; font-weight: bold;">(</span><span class="keyword" style="color: #990000;">this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>to<span class="operator" style="color: #663300; font-weight: bold;">,</span> to<span class="operator" style="color: #663300; font-weight: bold;">);</span><span class="flow" style="color: red;"><br />            if</span><span class="operator" style="color: #663300; font-weight: bold;"> (</span>left_to<span class="operator" style="color: #663300; font-weight: bold;"> -</span> left_from<span class="operator" style="color: #663300; font-weight: bold;"> &gt;</span><span class="int" style="color: #999900;"> 0</span><span class="operator" style="color: #663300; font-weight: bold;">)<br />            {</span><br />                result<span class="operator" style="color: #663300; font-weight: bold;"> +=</span><span class="keyword" style="color: #990000;"> this</span><span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>left<span class="operator" style="color: #663300; font-weight: bold;">-&gt;</span>query<span class="operator" style="color: #663300; font-weight: bold;">(</span>left_from<span class="operator" style="color: #663300; font-weight: bold;">,</span> left_to<span class="operator" style="color: #663300; font-weight: bold;">);<br />            }<br />        }</span><span class="flow" style="color: red;"><br /><br />        if</span><span class="opera
</body>
</html>