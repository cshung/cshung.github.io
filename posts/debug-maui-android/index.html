<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Debug MAUI Android | My Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="These days I have been helping the MAUI team to fix some bugs. I always learn something new when I work on something new, and this time is no different. Today I am going to write about how to debug the Android code running inside a MAUI app.
Procedure Step 1: Launching the App. I start the MAUI app in Visual Studio as usual. In this post, I am going to assume that we know how to start an App in Visual Studio.">
    <meta name="generator" content="Hugo 0.96.0" />
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    

  
  
    <link rel="stylesheet" href="/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css" >
  




    
      

    

    
    
    <meta property="og:title" content="Debug MAUI Android" />
<meta property="og:description" content="These days I have been helping the MAUI team to fix some bugs. I always learn something new when I work on something new, and this time is no different. Today I am going to write about how to debug the Android code running inside a MAUI app.
Procedure Step 1: Launching the App. I start the MAUI app in Visual Studio as usual. In this post, I am going to assume that we know how to start an App in Visual Studio." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cshung.github.io/posts/debug-maui-android/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-04T08:20:54-07:00" />
<meta property="article:modified_time" content="2022-04-04T08:20:54-07:00" />

<meta itemprop="name" content="Debug MAUI Android">
<meta itemprop="description" content="These days I have been helping the MAUI team to fix some bugs. I always learn something new when I work on something new, and this time is no different. Today I am going to write about how to debug the Android code running inside a MAUI app.
Procedure Step 1: Launching the App. I start the MAUI app in Visual Studio as usual. In this post, I am going to assume that we know how to start an App in Visual Studio."><meta itemprop="datePublished" content="2022-04-04T08:20:54-07:00" />
<meta itemprop="dateModified" content="2022-04-04T08:20:54-07:00" />
<meta itemprop="wordCount" content="794">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Debug MAUI Android"/>
<meta name="twitter:description" content="These days I have been helping the MAUI team to fix some bugs. I always learn something new when I work on something new, and this time is no different. Today I am going to write about how to debug the Android code running inside a MAUI app.
Procedure Step 1: Launching the App. I start the MAUI app in Visual Studio as usual. In this post, I am going to assume that we know how to start an App in Visual Studio."/>

      
    
	
  </head>

  <body class="ma0 avenir bg-near-white production">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My Blog
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://cshung.github.io/posts/debug-maui-android/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://cshung.github.io/posts/debug-maui-android/&amp;text=Debug%20MAUI%20Android" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://cshung.github.io/posts/debug-maui-android/&amp;title=Debug%20MAUI%20Android" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Debug MAUI Android</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-04-04T08:20:54-07:00">April 4, 2022</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>These days I have been helping the MAUI team to fix some bugs. I always learn something new when I work on something new, and this time is no different. Today I am going to write about how to debug the Android code running inside a MAUI app.</p>
<h1 id="procedure">Procedure</h1>
<h2 id="step-1-launching-the-app">Step 1: Launching the App.</h2>
<p>I start the MAUI app in Visual Studio as usual. In this post, I am going to assume that we know how to start an App in Visual Studio. We can even start it in debug mode so that we can debug the C# code as well. The mono debugger and the java debugger do not interfere each other and it is really convenient.</p>
<h2 id="step-2-finding-the-process">Step 2: Finding the process</h2>
<p>Next, we will want to attach the Java debugger. To do that, we need to know the process ID. We will use the <a href="https://developer.android.com/studio/command-line/adb">Android Debug Bridge</a> (adb) tool.</p>
<p>If you have MAUI installed with the Android workload, you should have the Android SDK already. On my windows machine, the tool is available on</p>
<pre tabindex="0"><code>C:\Program Files (x86)\Android\android-sdk\platform-tools\adb.exe
</code></pre><p>The tool has many options, but we will use only two of them. To find the process ID, we will use this command</p>
<pre tabindex="0"><code>C:\AndroidDebug&gt;adb.exe jdwp
</code></pre><p><code>jdwp</code> stands for <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jpda/jdwp-spec.html">Java Debug Wire Protocol</a>. Basically, this is a protocol that allows a Java debugger connects to so that it can remotely debug the process.</p>
<p>The command will list all the ID of all the process that expose the Java Debug Wire Protocol. That will include our app, and typically this is the last one in the output list.</p>
<pre tabindex="0"><code>C:\AndroidDebug&gt;adb jdwp
528
691
...
5019
6204
</code></pre><blockquote>
<p>Note that the process does not stop. To terminate the process, press Ctrl + C.</p>
</blockquote>
<h2 id="step-3-port-forwarding">Step 3: Port Forwarding</h2>
<p>Next, we will use the Android Debug Bridge to expose the debug port so that we can debug it. The port is currently opened on the Android emulator, but it is not accessible. To do make it accessible, the Android Debug Bridge will open a port on localhost so that it can be connected. The traffic are forwarded in and out the Android emulator so that we can debug.</p>
<p>The command to perform the port forwarding is as follow:</p>
<pre tabindex="0"><code>C:\AndroidDebug&gt;adb.exe forward tcp:12345 jdwp:6204
</code></pre><p>The command is self-explanatory. On the localhost, we will open a port 12345 and it will be connected to the Java Debug Wire Protocol of process 6204.</p>
<h2 id="step-4-visual-studio-code-configuration">Step 4: Visual Studio Code Configuration</h2>
<p>Now we can debug the Java code using a Java debugger. My personal choice is Visual Studio Code. Here is how I setup the Visual Studio Code for debugging Java.</p>
<ul>
<li>Install the Visual Studio Code Extension named &ldquo;Extension Pack for Java&rdquo;.</li>
<li>Create a new folder (I called mine <code>c:\AndroidDebug</code>).</li>
<li>Open the folder.</li>
<li>Click the (Run and Debug) button on the toolbar on the left hand side.</li>
<li>Create a <code>launch.json</code>.</li>
</ul>
<p>There are many options to set in <code>launch.json</code>, but we only need to set the mode to attach, the host, and the port number.</p>
<p>Here is my <code>launch.json</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Use IntelliSense to learn about possible attributes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Hover to view descriptions of existing attributes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.2.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;configurations&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;java&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Attach to Android&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;request&#34;</span>: <span style="color:#e6db74">&#34;attach&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;hostName&#34;</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">12345</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;sourcePaths&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;C:\\Users\\andrewau\\AppData\\Local\\Android\\Sdk\\sources\\android-30\\&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;C:\\Users\\andrewau\\AppData\\Local\\Android\\Sdk\\sources\\android-31\\&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="step-5-android-source-code">Step 5: Android Source Code</h2>
<p>Notice I specified a couple of source paths above. This is done to ensure I can step the sources, but where does those sources come from? As you can tell from the path, it comes from the Android SDK.</p>
<p>I installed my Android source code using Android Studio. It is available using the Tools -&gt; SDK Manager menu. At the lower right corner, there is a show package detail checkbox. This allowed me to pick the Android source code and install it.</p>
<h2 id="step-6-troubleshooting">Step 6: Troubleshooting</h2>
<p>There are a few caveats that I ran through:</p>
<ul>
<li>For some unknown reason, debugging does not work with the Android Studio is opened. Make sure you close all instances of Android Studio.</li>
<li>Make sure you install the right version of the source code. You need both the SDK that is used to build the app as well as the API version that the emulator is running.</li>
<li>If a breakpoint is hollow (i.e. not a solid red dot), it is invalid. It could be due to optimization or wrong API version. Check if you can set a breakpoint in some nearby lines.</li>
</ul>
<h1 id="final-words">Final words</h1>
<p>If you don&rsquo;t need to debug the Java code, you don&rsquo;t need any of these. In fact, MAUI should be encapsulating all of these from a developer so we don&rsquo;t need to do this. In my case, I need to debug something wrong in the MAUI implementation itself.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://cshung.github.io/" >
    &copy;  My Blog 2022 
  </a>
    <div>














</div>
  </div>
</footer>

    <div style="display:none">
    <script type="text/javascript" src="https://www.free-counters.org/count/86pd"></script><br><a href='http://www.counter-zaehler.de'>besucherz√§hler ip</a> <script type='text/javascript'     src='https://whomania.com/ctr?id=695d5b016077d10ada0ea41fc87e54f2421f8966'></script>
    </div>
  </body>

</html>
